<!DOCTYPE html>
<html lang="fr" data-fr-theme="light">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Widget tableau paginé DSFR - Navigation par pages avec contrôles avancés">
    <title>Tableau paginé DSFR - SignalConso</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.14.0/dist/dsfr.min.css">
    <style>
        body { margin: 0; font-family: Marianne, arial, sans-serif; }
        .fr-card__body { padding-bottom: 2rem !important; }
        .table-container { 
            margin: 2rem 0;
            overflow: visible !important;
        }
        .fr-table {
            width: 100% !important;
        }
        .fr-table table {
            width: 100% !important;
            min-width: 700px;
            table-layout: auto;
        }
        .fr-table__wrapper {
            overflow-x: auto;
        }
        .fr-table__container {
            width: 100%;
        }
        .fr-table__content {
            width: 100%;
        }
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 2rem;
        }
        .pagination-info {
            color: #666666;
            font-size: 0.875rem;
        }
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .page-button {
            min-width: 2.5rem;
            height: 2.5rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ddd;
            background: white;
            color: #000091;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        .page-button:hover:not(.active):not(:disabled) {
            background-color: #f5f5fe;
            border-color: #000091;
        }
        .page-button.active {
            background-color: #000091;
            color: white;
            border-color: #000091;
        }
        .page-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .page-size-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        @media (min-width: 768px) {
            .search-controls-row {
                display: flex;
                align-items: center;
                gap: 1rem;
            }
        }
        .quick-jump {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .quick-jump input {
            width: 4rem;
        }
        .table-loading {
            text-align: center;
            padding: 2rem;
            color: #666666;
        }
        .row-hover:hover {
            background-color: #f5f5fe;
        }
        .batch-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: #f5f5fe;
            border-radius: 0.25rem;
        }
        .selected-count {
            color: #000091;
            font-weight: bold;
        }
        /* Focus visible renforcé pour accessibilité */
        .fr-btn:focus-visible,
        .fr-input:focus-visible,
        .fr-select:focus-visible,
        .fr-checkbox-group input:focus-visible,
        button:focus-visible,
        .page-button:focus-visible,
        a:focus-visible {
            outline: 3px solid #000091;
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(0, 0, 145, 0.2);
        }
        
        .btn-close-modal:focus-visible {
            outline: 3px solid #000091;
            outline-offset: -2px;
        }
        
        @media (max-width: 768px) {
            .pagination-container {
                flex-direction: column;
                align-items: stretch;
            }
            .pagination-controls {
                justify-content: center;
            }
        }
        
        /* Styles pour la modale */
        #detail-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            border: none;
            padding: 0;
            margin: 0;
            background: transparent;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            border-radius: 0.5rem;
            box-shadow: 0 19px 38px rgba(0, 0, 0, 0.3), 0 15px 12px rgba(0, 0, 0, 0.22);
        }
        
        #detail-modal::backdrop {
            background: rgba(0, 0, 0, 0.5);
        }
        
        .modal-wrapper {
            background: white;
            height: 100%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid #e5e5e5;
        }
        
        .modal-header-content {
            flex: 1;
        }
        
        .modal-title {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 700;
            color: #161616;
        }
        
        .btn-close-modal {
            background: white;
            border: 2px solid #000091;
            color: #000091;
            border-radius: 0.25rem;
            width: 2.5rem;
            height: 2.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
            padding: 0;
        }
        
        .btn-close-modal:hover {
            background: #000091;
            color: white;
        }
        
        .btn-close-modal svg {
            width: 24px;
            height: 24px;
        }
        
        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            max-height: calc(80vh - 100px);
        }
        
        .modal-info-card {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: #f5f5fe;
            border-radius: 0.25rem;
        }
        
        .modal-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 0.5rem;
        }
        
        .modal-field-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .modal-field-label {
            color: #666666;
            font-size: 0.875rem;
        }
        
        .modal-field-value {
            color: #161616;
            font-size: 1rem;
        }
        
        /* Classe sr-only pour masquer visuellement mais garder accessible */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <!-- DÉBUT ZONE WIDGET TABLE-PAGINATED-001 -->
    <div id="widget-table-paginated-001" class="fr-container fr-py-3w">
        <div class="fr-grid-row">
            <div class="fr-col-12">
                <div class="fr-card">
                    <div class="fr-card__body">
                        <h2 class="fr-h4">Liste des signalements - Tableau paginé</h2>
                        <p class="fr-text--sm">Navigation optimisée pour grands volumes de données</p>
                        
                        <!-- Contrôles supérieurs -->
                        <div class="fr-grid-row fr-grid-row--gutters fr-mb-2w" style="align-items: flex-end;">
                            <div class="fr-col-12 fr-col-md-8">
                                <div class="fr-search-bar" role="search">
                                    <label for="search-input" class="sr-only">Recherche dans le tableau</label>
                                    <input class="fr-input" type="search" id="search-input" placeholder="Rechercher..." aria-label="Rechercher dans le tableau" onkeyup="searchTable()">
                                    <button class="fr-btn" title="Rechercher" aria-label="Lancer la recherche">
                                        Rechercher
                                    </button>
                                </div>
                            </div>
                            <div class="fr-col-12 fr-col-md-4">
                                <div class="page-size-selector" style="display: flex; align-items: center; justify-content: flex-end; height: 2.5rem;">
                                    <label for="page-size" style="margin-right: 0.5rem; white-space: nowrap;">Afficher :</label>
                                    <select class="fr-select" id="page-size" onchange="changePageSize()" style="width: auto;">
                                        <option value="10">10 lignes</option>
                                        <option value="25" selected>25 lignes</option>
                                        <option value="50">50 lignes</option>
                                        <option value="100">100 lignes</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Actions de masse (visible si sélection) -->
                        <div class="batch-actions" id="batch-actions" style="display: none;">
                            <div class="fr-checkbox-group">
                                <input type="checkbox" id="select-all" onchange="toggleSelectAll()">
                                <label class="fr-label" for="select-all">
                                    Tout sélectionner
                                </label>
                            </div>
                            <span class="selected-count">
                                <span id="selected-count">0</span> élément(s) sélectionné(s)
                            </span>
                            <button class="fr-btn fr-btn--sm fr-btn--secondary" onclick="exportSelected()">
                                Exporter la sélection
                            </button>
                            <button class="fr-btn fr-btn--sm fr-btn--tertiary" onclick="clearSelection()">
                                Effacer la sélection
                            </button>
                        </div>
                        
                        <!-- Tableau paginé -->
                        <div class="table-container">
                            <div class="fr-table fr-table--bordered">
                                <div class="fr-table__wrapper">
                                    <div class="fr-table__container">
                                        <div class="fr-table__content">
                                            <table id="paginated-table">
                                                <thead>
                                        <tr>
                                            <th scope="col">
                                                <input type="checkbox" id="header-checkbox" onchange="togglePageSelection()">
                                            </th>
                                            <th scope="col">Référence</th>
                                            <th scope="col">Date</th>
                                            <th scope="col">Entreprise</th>
                                            <th scope="col">Catégorie</th>
                                            <th scope="col">Département</th>
                                            <th scope="col">Statut</th>
                                            <th scope="col">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="table-body">
                                        <!-- Les données seront générées ici -->
                                    </tbody>
                                </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Indicateur de chargement -->
                            <div id="loading" class="table-loading" style="display: none;">
                                <div class="fr-loader"></div>
                                <p>Chargement des données...</p>
                            </div>
                        </div>
                        
                        <!-- Pagination -->
                        <div class="pagination-container">
                            <!-- Info pagination -->
                            <div class="pagination-info">
                                Affichage <strong id="start-item">1</strong> à <strong id="end-item">25</strong> 
                                sur <strong id="total-items">500</strong> résultats
                            </div>
                            
                            <!-- Contrôles de pagination -->
                            <div class="pagination-controls">
                                <button class="page-button" id="first-page" onclick="goToPage(1)" title="Première page">
                                    ≪
                                </button>
                                <button class="page-button" id="prev-page" onclick="previousPage()" title="Page précédente">
                                    ‹
                                </button>
                                
                                <div id="page-numbers">
                                    <!-- Les numéros de page seront générés ici -->
                                </div>
                                
                                <button class="page-button" id="next-page" onclick="nextPage()" title="Page suivante">
                                    ›
                                </button>
                                <button class="page-button" id="last-page" onclick="goToLastPage()" title="Dernière page">
                                    ≫
                                </button>
                            </div>
                            
                            <!-- Saut rapide -->
                            <div class="quick-jump">
                                <label for="jump-to" class="fr-label fr-label--inline">Aller à la page :</label>
                                <input type="number" class="fr-input" id="jump-to" min="1" aria-describedby="jump-hint" onkeypress="jumpToPage(event)">
                                <span class="fr-text--sm" id="jump-hint">/ <span id="total-pages">20</span> pages</span>
                            </div>
                        </div>
                        
                        <!-- Statistiques -->
                        <div class="fr-grid-row fr-grid-row--gutters fr-mt-3w">
                            <div class="fr-col-12 fr-col-md-3">
                                <div class="fr-tile">
                                    <div class="fr-tile__body">
                                        <p class="fr-tile__title">Page actuelle</p>
                                        <p class="fr-tile__desc fr-text--lg fr-text--bold" id="current-page-stat">1 / 20</p>
                                    </div>
                                </div>
                            </div>
                            <div class="fr-col-12 fr-col-md-3">
                                <div class="fr-tile">
                                    <div class="fr-tile__body">
                                        <p class="fr-tile__title">Résultats filtrés</p>
                                        <p class="fr-tile__desc fr-text--lg fr-text--bold" id="filtered-stat">500</p>
                                    </div>
                                </div>
                            </div>
                            <div class="fr-col-12 fr-col-md-3">
                                <div class="fr-tile">
                                    <div class="fr-tile__body">
                                        <p class="fr-tile__title">Temps de chargement</p>
                                        <p class="fr-tile__desc fr-text--lg fr-text--bold" id="load-time">0.2s</p>
                                    </div>
                                </div>
                            </div>
                            <div class="fr-col-12 fr-col-md-3">
                                <div class="fr-tile">
                                    <div class="fr-tile__body">
                                        <p class="fr-tile__title">Cache</p>
                                        <p class="fr-tile__desc fr-text--lg fr-text--bold" id="cache-status">Activé</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Information -->
                        <div class="fr-alert fr-alert--info fr-mt-3w">
                            <p class="fr-alert__title">Navigation optimisée</p>
                            <p>• Utilisez les flèches pour naviguer entre les pages<br/>
                            • Cliquez sur un numéro pour accéder directement à une page<br/>
                            • Modifiez le nombre de lignes affichées selon vos besoins<br/>
                            • Les données sont mises en cache pour une navigation rapide</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modale de détails -->
        <dialog id="detail-modal" role="dialog" aria-labelledby="detail-modal-title">
            <div class="modal-wrapper">
                <div class="modal-header">
                    <div class="modal-header-content">
                        <h2 id="detail-modal-title" class="modal-title">
                            Détails du signalement
                        </h2>
                    </div>
                    <button class="btn-close-modal" 
                            type="button"
                            title="Fermer" 
                            aria-label="Fermer la fenêtre"
                            onclick="closeDetailModal()">
                        <svg aria-hidden="true" focusable="false" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M12 10.586L16.95 5.636L18.364 7.05L13.414 12L18.364 16.95L16.95 18.364L12 13.414L7.05 18.364L5.636 16.95L10.586 12L5.636 7.05L7.05 5.636L12 10.586Z" fill="currentColor"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="modal-content">
                        <!-- Le contenu sera injecté ici -->
                    </div>
                </div>
            </div>
        </dialog>
    </div>
    <!-- FIN ZONE WIDGET TABLE-PAGINATED-001 -->
    
    <script>
        // Configuration
        const TOTAL_ITEMS = 500;
        let currentPage = 1;
        let pageSize = 25;
        let totalPages = Math.ceil(TOTAL_ITEMS / pageSize);
        let allData = [];
        let filteredData = [];
        let selectedItems = new Set();
        let loadStartTime = 0;
        
        // Génération de données fictives
        function generateMockData() {
            const categories = ['Téléphonie', 'Voyage', 'Produits', 'Voiture', 'Services', 'Santé', 'Travaux'];
            const departments = ['75', '13', '69', '59', '31', '33', '06', '44', '34', '67'];
            const statuses = ['Résolu', 'En cours', 'Transmis', 'En attente'];
            const companies = ['Orange', 'SFR', 'Bouygues', 'Free', 'EDF', 'Engie', 'Total', 'Carrefour', 'Leclerc', 'Amazon'];
            
            const data = [];
            for (let i = 1; i <= TOTAL_ITEMS; i++) {
                const date = new Date();
                date.setDate(date.getDate() - Math.floor(Math.random() * 365));
                
                data.push({
                    id: `REF-2024-${String(i).padStart(5, '0')}`,
                    date: date,
                    company: companies[Math.floor(Math.random() * companies.length)],
                    category: categories[Math.floor(Math.random() * categories.length)],
                    department: departments[Math.floor(Math.random() * departments.length)],
                    status: statuses[Math.floor(Math.random() * statuses.length)]
                });
            }
            return data;
        }
        
        // Initialisation
        function initTable() {
            allData = generateMockData();
            filteredData = [...allData];
            loadPage(1);
            updatePaginationControls();
        }
        
        // Chargement d'une page
        function loadPage(page) {
            loadStartTime = performance.now();
            
            // Simulation chargement
            document.getElementById('loading').style.display = 'block';
            document.getElementById('paginated-table').style.opacity = '0.5';
            
            setTimeout(() => {
                currentPage = page;
                const start = (page - 1) * pageSize;
                const end = start + pageSize;
                const pageData = filteredData.slice(start, end);
                
                renderTable(pageData, start);
                updatePaginationInfo();
                updatePaginationControls();
                
                // Fin chargement
                document.getElementById('loading').style.display = 'none';
                document.getElementById('paginated-table').style.opacity = '1';
                
                // Temps de chargement
                const loadTime = ((performance.now() - loadStartTime) / 1000).toFixed(2);
                document.getElementById('load-time').textContent = loadTime + 's';
            }, 200);
        }
        
        // Rendu du tableau
        function renderTable(data, startIndex) {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            
            data.forEach((row, index) => {
                const tr = tbody.insertRow();
                tr.className = 'row-hover';
                
                // Checkbox
                const cellCheck = tr.insertCell(0);
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = row.id;
                checkbox.checked = selectedItems.has(row.id);
                checkbox.onchange = () => toggleItemSelection(row.id);
                cellCheck.appendChild(checkbox);
                
                // Référence
                tr.insertCell(1).innerHTML = `<strong>${row.id}</strong>`;
                
                // Date
                tr.insertCell(2).textContent = row.date.toLocaleDateString('fr-FR');
                
                // Entreprise
                tr.insertCell(3).textContent = row.company;
                
                // Catégorie
                tr.insertCell(4).textContent = row.category;
                
                // Département
                tr.insertCell(5).textContent = row.department;
                
                // Statut
                const cellStatus = tr.insertCell(6);
                const statusClass = row.status === 'Résolu' ? 'fr-badge--success' :
                                   row.status === 'En cours' ? 'fr-badge--info' :
                                   row.status === 'Transmis' ? 'fr-badge--warning' : '';
                cellStatus.innerHTML = `<span class="fr-badge ${statusClass}">${row.status}</span>`;
                
                // Actions
                const cellActions = tr.insertCell(7);
                cellActions.innerHTML = `
                    <button class="fr-btn fr-btn--tertiary-no-outline fr-btn--sm" onclick="openDetailModal('${row.id}')">
                        Voir détails
                    </button>
                `;
            });
            
            updateSelectionDisplay();
        }
        
        // Mise à jour des infos de pagination
        function updatePaginationInfo() {
            const start = (currentPage - 1) * pageSize + 1;
            const end = Math.min(currentPage * pageSize, filteredData.length);
            
            document.getElementById('start-item').textContent = start;
            document.getElementById('end-item').textContent = end;
            document.getElementById('total-items').textContent = filteredData.length;
            document.getElementById('total-pages').textContent = totalPages;
            document.getElementById('current-page-stat').textContent = `${currentPage} / ${totalPages}`;
            document.getElementById('filtered-stat').textContent = filteredData.length;
        }
        
        // Mise à jour des contrôles de pagination
        function updatePaginationControls() {
            // Boutons précédent/suivant
            document.getElementById('first-page').disabled = currentPage === 1;
            document.getElementById('prev-page').disabled = currentPage === 1;
            document.getElementById('next-page').disabled = currentPage === totalPages;
            document.getElementById('last-page').disabled = currentPage === totalPages;
            
            // Numéros de page
            const pageNumbers = document.getElementById('page-numbers');
            pageNumbers.innerHTML = '';
            
            // Logique d'affichage des numéros (max 7 boutons)
            let startPage = Math.max(1, currentPage - 3);
            let endPage = Math.min(totalPages, startPage + 6);
            
            if (endPage - startPage < 6) {
                startPage = Math.max(1, endPage - 6);
            }
            
            // Ellipse début
            if (startPage > 1) {
                const ellipse = document.createElement('span');
                ellipse.textContent = '...';
                ellipse.style.padding = '0 0.5rem';
                pageNumbers.appendChild(ellipse);
            }
            
            // Boutons de page
            for (let i = startPage; i <= endPage; i++) {
                const button = document.createElement('button');
                button.className = 'page-button';
                if (i === currentPage) {
                    button.classList.add('active');
                }
                button.textContent = i;
                button.onclick = () => goToPage(i);
                pageNumbers.appendChild(button);
            }
            
            // Ellipse fin
            if (endPage < totalPages) {
                const ellipse = document.createElement('span');
                ellipse.textContent = '...';
                ellipse.style.padding = '0 0.5rem';
                pageNumbers.appendChild(ellipse);
            }
        }
        
        // Navigation
        function goToPage(page) {
            if (page >= 1 && page <= totalPages) {
                loadPage(page);
            }
        }
        
        function previousPage() {
            if (currentPage > 1) {
                goToPage(currentPage - 1);
            }
        }
        
        function nextPage() {
            if (currentPage < totalPages) {
                goToPage(currentPage + 1);
            }
        }
        
        function goToLastPage() {
            goToPage(totalPages);
        }
        
        function jumpToPage(event) {
            if (event.key === 'Enter') {
                const page = parseInt(document.getElementById('jump-to').value);
                if (page) {
                    goToPage(page);
                    document.getElementById('jump-to').value = '';
                }
            }
        }
        
        // Changement de taille de page
        function changePageSize() {
            pageSize = parseInt(document.getElementById('page-size').value);
            totalPages = Math.ceil(filteredData.length / pageSize);
            currentPage = 1;
            loadPage(1);
        }
        
        // Recherche
        function searchTable() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            
            if (searchTerm === '') {
                filteredData = [...allData];
            } else {
                filteredData = allData.filter(row => {
                    return row.id.toLowerCase().includes(searchTerm) ||
                           row.company.toLowerCase().includes(searchTerm) ||
                           row.category.toLowerCase().includes(searchTerm) ||
                           row.department.includes(searchTerm);
                });
            }
            
            totalPages = Math.ceil(filteredData.length / pageSize);
            currentPage = 1;
            loadPage(1);
        }
        
        // Gestion de la sélection
        function toggleItemSelection(id) {
            if (selectedItems.has(id)) {
                selectedItems.delete(id);
            } else {
                selectedItems.add(id);
            }
            updateSelectionDisplay();
        }
        
        function togglePageSelection() {
            const checkboxes = document.querySelectorAll('#table-body input[type="checkbox"]');
            const headerCheckbox = document.getElementById('header-checkbox');
            
            checkboxes.forEach(cb => {
                if (headerCheckbox.checked) {
                    selectedItems.add(cb.value);
                } else {
                    selectedItems.delete(cb.value);
                }
                cb.checked = headerCheckbox.checked;
            });
            
            updateSelectionDisplay();
        }
        
        function toggleSelectAll() {
            const selectAll = document.getElementById('select-all');
            
            if (selectAll.checked) {
                filteredData.forEach(item => selectedItems.add(item.id));
            } else {
                selectedItems.clear();
            }
            
            // Recharger la page courante pour mettre à jour les checkboxes
            loadPage(currentPage);
        }
        
        function clearSelection() {
            selectedItems.clear();
            document.getElementById('select-all').checked = false;
            document.getElementById('header-checkbox').checked = false;
            loadPage(currentPage);
        }
        
        function updateSelectionDisplay() {
            const count = selectedItems.size;
            document.getElementById('selected-count').textContent = count;
            document.getElementById('batch-actions').style.display = count > 0 ? 'flex' : 'none';
            
            // Mise à jour header checkbox
            const pageCheckboxes = document.querySelectorAll('#table-body input[type="checkbox"]');
            const checkedCount = Array.from(pageCheckboxes).filter(cb => cb.checked).length;
            const headerCheckbox = document.getElementById('header-checkbox');
            
            if (checkedCount === 0) {
                headerCheckbox.checked = false;
                headerCheckbox.indeterminate = false;
            } else if (checkedCount === pageCheckboxes.length) {
                headerCheckbox.checked = true;
                headerCheckbox.indeterminate = false;
            } else {
                headerCheckbox.checked = false;
                headerCheckbox.indeterminate = true;
            }
        }
        
        function exportSelected() {
            alert(`Export de ${selectedItems.size} élément(s) sélectionné(s)`);
        }
        
        // Fonctions de la modale
        function openDetailModal(id) {
            const modal = document.getElementById('detail-modal');
            const modalContent = document.getElementById('modal-content');
            
            // Trouver les données du signalement
            const item = allData.find(d => d.id === id);
            if (!item) return;
            
            // Générer le contenu détaillé
            modalContent.innerHTML = `
                <!-- Alert avec référence -->
                <div class="fr-alert fr-alert--info fr-alert--sm fr-mb-3w">
                    <p class="fr-alert__title">Référence du signalement</p>
                    <p><code>${item.id}</code></p>
                </div>
                
                <!-- Informations principales -->
                <div class="modal-info-card">
                    <h3 class="fr-h6">Informations générales</h3>
                    <div class="modal-info-grid">
                        <div class="modal-field-group">
                            <div class="modal-field-label">Date de création</div>
                            <div class="modal-field-value">
                                <strong>${item.date.toLocaleDateString('fr-FR', { 
                                    day: 'numeric', 
                                    month: 'long', 
                                    year: 'numeric' 
                                })}</strong>
                            </div>
                        </div>
                        <div class="modal-field-group">
                            <div class="modal-field-label">Entreprise</div>
                            <div class="modal-field-value">
                                <span class="fr-badge fr-badge--info">${item.company}</span>
                            </div>
                        </div>
                        <div class="modal-field-group">
                            <div class="modal-field-label">Catégorie</div>
                            <div class="modal-field-value">
                                <span class="fr-badge">${item.category}</span>
                            </div>
                        </div>
                        <div class="modal-field-group">
                            <div class="modal-field-label">Département</div>
                            <div class="modal-field-value">
                                <strong>${item.department}</strong>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- État du dossier -->
                <div class="modal-info-card">
                    <h3 class="fr-h6">État du dossier</h3>
                    <div class="modal-info-grid">
                        <div class="modal-field-group">
                            <div class="modal-field-label">Statut actuel</div>
                            <div class="modal-field-value">
                                <span class="fr-badge ${
                                    item.status === 'Résolu' ? 'fr-badge--success' :
                                    item.status === 'En cours' ? 'fr-badge--info' :
                                    item.status === 'Transmis' ? 'fr-badge--warning' : ''
                                }">${item.status}</span>
                            </div>
                        </div>
                        <div class="modal-field-group">
                            <div class="modal-field-label">Dernière mise à jour</div>
                            <div class="modal-field-value">
                                <strong>${new Date().toLocaleDateString('fr-FR')}</strong>
                            </div>
                        </div>
                        <div class="modal-field-group">
                            <div class="modal-field-label">Agent assigné</div>
                            <div class="modal-field-value">Jean Dupont</div>
                        </div>
                        <div class="modal-field-group">
                            <div class="modal-field-label">Priorité</div>
                            <div class="modal-field-value">Normale</div>
                        </div>
                    </div>
                </div>
                
                <!-- Description -->
                <div class="modal-info-card">
                    <h3 class="fr-h6">Description du signalement</h3>
                    <p>
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
                        Le consommateur signale un problème concernant ${item.category.toLowerCase()} 
                        avec l'entreprise ${item.company}. Le dossier est actuellement ${item.status.toLowerCase()}.
                    </p>
                </div>
                
                <!-- État du traitement -->
                <div class="fr-callout fr-callout--blue-ecume">
                    <h3 class="fr-callout__title">État du traitement</h3>
                    <ul class="fr-tags-group">
                        <li>
                            <p class="fr-tag ${item.status === 'Transmis' ? 'fr-tag--green-emeraude' : 'fr-tag--grey'}">
                                ${item.status === 'Transmis' ? '✓' : '✗'} Transmis
                            </p>
                        </li>
                        <li>
                            <p class="fr-tag fr-tag--green-emeraude">
                                ✓ Lu
                            </p>
                        </li>
                        <li>
                            <p class="fr-tag ${item.status === 'Résolu' ? 'fr-tag--green-emeraude' : 'fr-tag--grey'}">
                                ${item.status === 'Résolu' ? '✓' : '✗'} Réponse
                            </p>
                        </li>
                    </ul>
                </div>
                
                <!-- Actions effectuées -->
                <div class="modal-info-card fr-mt-3w">
                    <h3 class="fr-h6">Actions effectuées</h3>
                    <ul>
                        <li>
                            <strong>${item.date.toLocaleDateString('fr-FR')}</strong> - Réception du signalement
                        </li>
                        <li>
                            <strong>${new Date(item.date.getTime() + 86400000).toLocaleDateString('fr-FR')}</strong> - Analyse du dossier
                        </li>
                        <li>
                            <strong>${new Date(item.date.getTime() + 172800000).toLocaleDateString('fr-FR')}</strong> - Contact avec l'entreprise
                        </li>
                    </ul>
                </div>
            `;
            
            // Ouvrir la modale
            if (typeof modal.showModal === 'function') {
                modal.showModal();
            } else {
                modal.setAttribute('open', '');
                modal.style.display = 'block';
            }
        }
        
        function closeDetailModal() {
            const modal = document.getElementById('detail-modal');
            if (modal) {
                if (typeof modal.close === 'function') {
                    modal.close();
                } else {
                    modal.removeAttribute('open');
                    modal.style.display = 'none';
                }
            }
        }
        
        function exportDetail() {
            const modalContent = document.getElementById('modal-content').innerText;
            const blob = new Blob([modalContent], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'detail-signalement.txt';
            link.click();
            closeDetailModal();
        }
        
        // Fermer la modale avec Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeDetailModal();
            }
        });
        
        // Raccourcis clavier
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName !== 'INPUT') {
                if (e.key === 'ArrowLeft') previousPage();
                if (e.key === 'ArrowRight') nextPage();
                if (e.key === 'Home') goToPage(1);
                if (e.key === 'End') goToLastPage();
            }
        });
        
        // Support clavier amélioré
        document.addEventListener('DOMContentLoaded', function() {
            initTable();
            
            // Support clavier pour bouton fermer modale
            const closeBtn = document.querySelector('.btn-close-modal');
            if (closeBtn) {
                closeBtn.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        closeDetailModal();
                    }
                });
            }
            
            // Support clavier pour boutons de pagination
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('page-button')) {
                    e.target.addEventListener('keydown', function(evt) {
                        if (evt.key === 'Enter' || evt.key === ' ') {
                            evt.preventDefault();
                            this.click();
                        }
                    });
                }
            });
            
            // Gestion focus trap dans la modale
            const modal = document.getElementById('detail-modal');
            let focusableElements;
            
            modal.addEventListener('keydown', function(e) {
                if (!modal.hasAttribute('open')) return;
                
                focusableElements = modal.querySelectorAll(
                    'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
                );
                
                const firstFocusable = focusableElements[0];
                const lastFocusable = focusableElements[focusableElements.length - 1];
                
                // Trap Tab navigation
                if (e.key === 'Tab') {
                    if (e.shiftKey) { // Shift + Tab
                        if (document.activeElement === firstFocusable) {
                            e.preventDefault();
                            lastFocusable.focus();
                        }
                    } else { // Tab
                        if (document.activeElement === lastFocusable) {
                            e.preventDefault();
                            firstFocusable.focus();
                        }
                    }
                }
            });
            
            // Améliorer l'accessibilité des checkboxes
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.checked = !this.checked;
                        this.dispatchEvent(new Event('change'));
                    }
                });
            });
        });
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.14.0/dist/dsfr.module.min.js"></script>
</body>
</html>